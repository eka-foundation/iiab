server {
      root {{ doc_root }};
      server_name {{ iiab_hostname }};
 
      access_log {{ apache_log_dir }}/access.log;
      error_log {{ apache_log_dir }}/error.log;
      location / { 
            # this is the location block for the document root of this vhost
            include uwsgi_params;
            #uwsgi_pass         uwsgicluster;

            proxy_redirect     off;
            proxy_set_header   Host $host;
            proxy_set_header   X-Real-IP $remote_addr;
            proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header   X-Forwarded-Host $server_name;
      } 

      # let individual services drop location blocks in sites-enabled
      include /etc/nginx/conf.d/*;
 
      location ~ *\.php$ {
	    include fastcgi_params;
	    fastcgi_index index.php;
            fastcgi_split_path_info ^(.+\.php)(/.+)$;
	    fastcgi_pass unix:/run/php/php7.0-fpm.sock;
	    fastcgi_param   SCRIPT_FILENAME    $document_root$fastcgi_script_name;
	    fastcgi_param   SCRIPT_NAME        $fastcgi_script_name;

       }
 
       # if you don't like seeing all the errors for missing favicon.ico in root
       location = /favicon.ico { access_log off; log_not_found off; }
 
       # if you don't like seeing errors for a missing robots.txt in root
       location = /robots.txt { access_log off; log_not_found off; }
 
       # this will prevent files like .htaccess .htpassword .secret etc from being served
       location ~ /\. { deny all; }
}
